<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Round Room</title>   
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="images/Icon.png">
    <script src="script.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="top-nav">
        <div class="container">
            <button class="arrow" onclick="window.location.href='order_page.html'">
                <div class = "bar4"></div>
                <div class = "bar5"></div>
            </button>
            <div class="logo">
                <h1 href="#story">THE ROUND ROOM</h1>
            </div>
            <img class="iconpic" src="images/Icon.png" alt="Logo">
        </div>
    </nav>
    <main class="section-checkout">
        <h2 style="text-align:center; margin-bottom:1rem;">Checkout</h2>

        <aside class="checkout-summary" id="checkoutSummary">
            <h3>Your order</h3>
            <div id="checkoutItems" class="checkout-items">
                <p class="empty-cart">No items in your cart.</p>
            </div>
            <div class="checkout-breakdown">
                <div class="row"><span>Subtotal</span><span id="checkoutSubtotal">₹0.00</span></div>
                <div class="row"><span>Tax (5%)</span><span id="checkoutTax">₹0.00</span></div>
                <div class="row total"><span>Total</span><span id="checkoutTotal">₹0.00</span></div>
            </div>
        </aside>

        <form id="checkoutForm" class="checkout-form" novalidate>
            <div class="form-section">
                <label for="firstName">First name *</label>
                <input id="firstName" name="firstName" type="text" required aria-required="true" placeholder="First name">
            </div>

            <div class="form-section">
                <label for="lastName">Surname *</label>
                <input id="lastName" name="lastName" type="text" required aria-required="true" placeholder="Surname">
            </div>

            <div class="form-section">
                <label for="address">Address *</label>
                <textarea id="address" name="address" required aria-required="true" placeholder="Street, house number, city"></textarea>
            </div>

            <div class="form-section">
                <label for="phone">Phone number *</label>
                <input id="phone" name="phone" type="tel" inputmode="tel" required aria-required="true" placeholder="e.g., +98 9...">
            </div>

            <div class="form-section">
                <label for="note">Order note (optional)</label>
                <textarea id="note" name="note" placeholder="Any special instructions (optional)"></textarea>
            </div>

            <div style="display:flex; gap:1rem; align-items:center; margin-top:1rem;">
                <button type="submit" class="btn-submit">Place order</button>
                <a href="order_page.html" class="order-button" style="margin-left:0;">Back to menu</a>
            </div>
        </form>
    </main>

    <script>
    // Render saved cart into the checkout summary and enable/disable submit
    (function() {
      function renderCartSummary() {
        const raw = localStorage.getItem('rr_cart');
        const itemsEl = document.getElementById('checkoutItems');
        const subEl = document.getElementById('checkoutSubtotal');
        const taxEl = document.getElementById('checkoutTax');
        const totalEl = document.getElementById('checkoutTotal');
        const submitBtn = document.querySelector('#checkoutForm .btn-submit');

        if (!raw) {
          if (itemsEl) itemsEl.innerHTML = '<p class="empty-cart">Your cart is empty. Please add items first.</p>';
          if (submitBtn) submitBtn.disabled = true;
          return;
        }
        try {
          const cart = JSON.parse(raw);
          if (!cart.items || cart.items.length === 0) {
            if (itemsEl) itemsEl.innerHTML = '<p class="empty-cart">Your cart is empty. Please add items first.</p>';
            if (submitBtn) submitBtn.disabled = true;
            return;
          }

          if (itemsEl) {
            itemsEl.innerHTML = cart.items.map(it => `
              <div class="checkout-item">
                <div class="left"><span class="qty">${it.qty}x</span><span class="name">${it.name}</span></div>
                <div class="right">₹${it.itemTotal.toFixed(2)}</div>
              </div>
            `).join('');
          }

          if (subEl) subEl.textContent = `₹${cart.subtotal.toFixed(2)}`;
          if (taxEl) taxEl.textContent = `₹${cart.tax.toFixed(2)}`;
          if (totalEl) totalEl.textContent = `₹${cart.total.toFixed(2)}`;
          if (submitBtn) submitBtn.disabled = false;
        } catch (err) {
          console.warn('Could not parse cart', err);
          if (itemsEl) itemsEl.innerHTML = '<p class="empty-cart">Your cart could not be loaded.</p>';
          if (submitBtn) submitBtn.disabled = true;
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderCartSummary);
      } else {
        renderCartSummary();
      }

      // Also re-render when storage changes in another tab
      window.addEventListener('storage', function(e) {
        if (e.key === 'rr_cart') renderCartSummary();
      });
    })();
    </script>

</body>
</html>